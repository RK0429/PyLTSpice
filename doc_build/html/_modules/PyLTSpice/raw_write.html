
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PyLTSpice.raw_write &#8212; PyLTSpice 3.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for PyLTSpice.raw_write</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># coding=utf-8</span>

<span class="c1"># -------------------------------------------------------------------------------</span>
<span class="c1"># Name:        raw_write.py</span>
<span class="c1"># Purpose:     Create RAW Files</span>
<span class="c1">#</span>
<span class="c1"># Author:      Nuno Brum (nuno.brum@gmail.com)</span>
<span class="c1">#</span>
<span class="c1"># Created:     16-10-2021</span>
<span class="c1"># Licence:     refer to the LICENSE file</span>
<span class="c1"># -------------------------------------------------------------------------------</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module generates RAW Files from user data.</span>
<span class="sd">It can be used to combine RAW files generated by different Simulation Runs</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">strftime</span>

<span class="kn">from</span> <span class="nn">.raw_read</span> <span class="kn">import</span> <span class="n">RawRead</span>
<span class="kn">from</span> <span class="nn">.raw_classes</span> <span class="kn">import</span> <span class="n">DataSet</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span><span class="p">,</span> <span class="n">float32</span><span class="p">,</span> <span class="n">zeros</span>


<div class="viewcode-block" id="Trace"><a class="viewcode-back" href="../../raw_write.html#PyLTSpice.raw_write.Trace">[docs]</a><span class="k">class</span> <span class="nc">Trace</span><span class="p">(</span><span class="n">DataSet</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper class representing a trace. This class is based on DataSet, therefore, it doesn&#39;t support STEPPED data.</span>
<span class="sd">    :param name: name of the trace being created</span>
<span class="sd">    :type name: str</span>
<span class="sd">    :param whattype: time, frequency, voltage or current</span>
<span class="sd">    :type whattype: str</span>
<span class="sd">    :param data: data for the data write</span>
<span class="sd">    :type data: list or numpy.array</span>
<span class="sd">    :param numerical_type: real or complex</span>
<span class="sd">    :type numerical_type: str</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">whattype</span><span class="o">=</span><span class="s1">&#39;voltage&#39;</span><span class="p">,</span> <span class="n">numerical_type</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span>
            <span class="n">whattype</span> <span class="o">=</span> <span class="s1">&#39;time&#39;</span>
        <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;frequency&#39;</span><span class="p">:</span>
            <span class="n">whattype</span> <span class="o">=</span> <span class="s1">&#39;frequency&#39;</span>
        <span class="k">if</span> <span class="n">numerical_type</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span>
                <span class="n">numerical_type</span> <span class="o">=</span> <span class="s1">&#39;double&#39;</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;frequency&#39;</span><span class="p">:</span>
                <span class="n">numerical_type</span> <span class="o">=</span> <span class="s1">&#39;complex&#39;</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">float32</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">float</span><span class="p">):</span>
                <span class="n">numerical_type</span> <span class="o">=</span> <span class="s1">&#39;real&#39;</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">complex</span><span class="p">):</span>
                <span class="n">numerical_type</span> <span class="o">=</span> <span class="s1">&#39;complex&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span>

        <span class="n">DataSet</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">whattype</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">numerical_type</span><span class="o">=</span><span class="n">numerical_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:]</span>  <span class="c1"># This way the dtype is kept</span></div>


<div class="viewcode-block" id="RawWrite"><a class="viewcode-back" href="../../raw_write.html#PyLTSpice.raw_write.RawWrite">[docs]</a><span class="k">class</span> <span class="nc">RawWrite</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class represents the RAW data file being generated. Contrary to the RawRead this class doesn&#39;t support stepped</span>
<span class="sd">    data.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plot_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fastacces</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">numtype</span><span class="o">=</span><span class="s1">&#39;real&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf_16_le&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_traces</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag_numtype</span> <span class="o">=</span> <span class="n">numtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag_forward</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag_log</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag_stepped</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag_fastaccess</span> <span class="o">=</span> <span class="n">fastacces</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_name</span> <span class="o">=</span> <span class="n">plot_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">encoding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_imported_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_new_axis</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_str_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">flag_numtype</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_forward</span><span class="p">:</span>
            <span class="n">flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;forward&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_log</span><span class="p">:</span>
            <span class="n">flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_stepped</span><span class="p">:</span>
            <span class="n">flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;stepped&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_fastaccess</span><span class="p">:</span>
            <span class="n">flags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;fastaccess&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>

<div class="viewcode-block" id="RawWrite.add_trace"><a class="viewcode-back" href="../../raw_write.html#PyLTSpice.raw_write.RawWrite.add_trace">[docs]</a>    <span class="k">def</span> <span class="nf">add_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace</span><span class="p">:</span> <span class="n">Trace</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds a trace to the RAW file. The trace needs to have the same size as trace 0 (&#39;time&#39;, &#39;frequency&#39;, etc..)</span>
<span class="sd">        The first trace added defines the X-Axis and therefore the type of RAW file being generated. If no plot name</span>
<span class="sd">        was defined, it will automatically assign a name.</span>
<span class="sd">        :param trace: Needs to be of the</span>
<span class="sd">        :type trace:</span>
<span class="sd">        :return: Nothing</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">Trace</span><span class="p">),</span> <span class="s2">&quot;The trace needs to be of the type &quot;&quot;Trace&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_traces</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">trace</span><span class="o">.</span><span class="n">whattype</span> <span class="o">==</span> <span class="s1">&#39;time&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_name</span> <span class="ow">or</span> <span class="s1">&#39;Transient Analysis&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">flag_numtype</span> <span class="o">=</span> <span class="s1">&#39;real&#39;</span>
            <span class="k">elif</span> <span class="n">trace</span><span class="o">.</span><span class="n">whattype</span> <span class="o">==</span> <span class="s1">&#39;frequency&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_name</span> <span class="ow">or</span> <span class="s1">&#39;AC Analysis&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">flag_numtype</span> <span class="o">=</span> <span class="s1">&#39;complex&#39;</span>
            <span class="k">elif</span> <span class="n">trace</span><span class="o">.</span><span class="n">whattype</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;voltage&#39;</span><span class="p">,</span> <span class="s1">&#39;current&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_name</span> <span class="ow">or</span> <span class="s1">&#39;DC transfer characteristic&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">flag_numtype</span> <span class="o">=</span> <span class="s1">&#39;real&#39;</span>
            <span class="k">elif</span> <span class="n">trace</span><span class="o">.</span><span class="n">whattype</span> <span class="o">==</span> <span class="s1">&#39;param&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_name</span> <span class="ow">or</span> <span class="s1">&#39;Operating Point&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">flag_numtype</span> <span class="o">=</span> <span class="s1">&#39;real&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;First Trace needs to be either &#39;time&#39;, &#39;frequency&#39;, &#39;param&#39;, &#39;voltage&#39; or &#39;...&#39;&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_traces</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s2">&quot;The trace needs to be the same size as trace 0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_traces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span></div>

<div class="viewcode-block" id="RawWrite.save"><a class="viewcode-back" href="../../raw_write.html#PyLTSpice.raw_write.RawWrite.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves the RAW file into a file. The file format is always binary. Text based RAW output format is not supported</span>
<span class="sd">        in this version.</span>
<span class="sd">        :param filename: filename to where the RAW file is going to be written. Make sure that the extension of the</span>
<span class="sd">        file is .RAW.</span>

<span class="sd">        :type filename: str or pathlib.Path</span>
<span class="sd">        :return: Nothing</span>
<span class="sd">        :rtype: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_imported_data</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_consolidate</span><span class="p">()</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Title: * PyLTSpice RawWrite</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Date: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%a</span><span class="s2"> %b </span><span class="si">%d</span><span class="s2"> %H:%M:%S %Y&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Plotname: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_name</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Flags: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_str_flags</span><span class="p">())</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;No. Variables: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_traces</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;No. Points: </span><span class="si">{:12}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_traces</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Offset:   </span><span class="si">{:.16e}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Command: Linear Technology Corporation LTspice XVII</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">))</span>
        <span class="c1"># f.write(&quot;Backannotation: \n&quot;.encode(self.encoding))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Variables:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">trace</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_traces</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="si">{0}</span><span class="se">\t</span><span class="si">{1}</span><span class="se">\t</span><span class="si">{2}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">trace</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">trace</span><span class="o">.</span><span class="n">whattype</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">))</span>
        <span class="n">total_bytes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Binary:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_fastaccess</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_numtype</span> <span class="o">!=</span> <span class="s1">&#39;complex&#39;</span><span class="p">:</span>  <span class="c1"># Don&#39;t know why, but complex RAW files aren&#39;t</span>
            <span class="c1"># converted to FastAccess</span>
            <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_traces</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">tobytes</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fmts</span> <span class="o">=</span> <span class="p">{</span><span class="n">trace</span><span class="p">:</span> <span class="n">tobytes_for_trace</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span> <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_traces</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_traces</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
                <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_traces</span><span class="p">:</span>
                    <span class="n">total_bytes</span> <span class="o">+=</span> <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fmts</span><span class="p">[</span><span class="n">trace</span><span class="p">](</span><span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_rename_netlabel</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Renames a trace name making sure that the V() or I() containers are left intact.&quot;&quot;&quot;</span>
        <span class="c1"># Make the rename as requested</span>
        <span class="k">if</span> <span class="s1">&#39;rename_format&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;V(&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;I(&#39;</span><span class="p">):</span>
                <span class="n">new_name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;rename_format&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">+</span> <span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;rename_format&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">new_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">name</span>

    <span class="k">def</span> <span class="nf">_name_exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="c1"># first check whether it is a duplicate</span>
        <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_traces</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">trace</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

<div class="viewcode-block" id="RawWrite.add_traces_from_raw"><a class="viewcode-back" href="../../raw_write.html#PyLTSpice.raw_write.RawWrite.add_traces_from_raw">[docs]</a>    <span class="k">def</span> <span class="nf">add_traces_from_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">RawRead</span><span class="p">,</span> <span class="n">trace_filter</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; *(Not fully implemented)*</span>

<span class="sd">        Merge two RawWrite classes together resulting in a new instance</span>
<span class="sd">        :param other: an instance of the RawRead class where the traces are going to be copied from.</span>
<span class="sd">        :type other: RawRead</span>
<span class="sd">        :param trace_filter: A list of signals that should be imported into the new file</span>
<span class="sd">        :type trace_filter: list, Tuple, or just a string for one trace</span>

<span class="sd">        :keyword force_axis_alignment: If two raw files don&#39;t have the same axis, an attempt is made to sync the two</span>

<span class="sd">        :keyword admissible_error: maximum error allowed in the sync between the two axis</span>

<span class="sd">        :keyword rename_format: when adding traces with the same name, it is possible to define a rename format.</span>
<span class="sd">            For example, if there are two traces named N001 in order to avoid duplicate names the rename format can be</span>
<span class="sd">            defined as &quot;{}_{kwarg_name} where kwarg_name is passed as a keyword argument of this function. If just one</span>
<span class="sd">            trace is being added, this can be used to simply give the new name.</span>

<span class="sd">        :keyword step: by default only step 0 is added from the second raw. It is possible to add other steps, by</span>
<span class="sd">            using this keyword parameter. This is useful when we want to &quot;flatten&quot; the multiple step runs into the same</span>
<span class="sd">            view.</span>

<span class="sd">        :keyword: minimum_timestep: This parameter forces the two axis to sync using a minimum time step. That is, all</span>
<span class="sd">            time increments that are less than this parameter will be suppressed.</span>

<span class="sd">        :returns: Nothing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">force_axis_alignment</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;force_axis_alignment&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">admissible_error</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;admissible_error&#39;</span><span class="p">,</span> <span class="mf">1e-11</span><span class="p">)</span>
        <span class="n">from_step</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">minimum_timestep</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;minimum_timestep&#39;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trace_filter</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">trace_filter</span> <span class="o">=</span> <span class="p">[</span><span class="n">trace_filter</span><span class="p">]</span>

        <span class="n">other_flags</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">get_raw_property</span><span class="p">(</span><span class="s1">&#39;Flags&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">flag</span> <span class="ow">in</span> <span class="n">other_flags</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">flag</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;real&#39;</span><span class="p">,</span> <span class="s1">&#39;complex&#39;</span><span class="p">):</span>
                <span class="n">other_flag_num_type</span> <span class="o">=</span> <span class="n">flag</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">other_flag_num_type</span> <span class="o">=</span> <span class="s1">&#39;real&#39;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_traces</span><span class="p">):</span>  <span class="c1"># there are already traces</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag_numtype</span> <span class="o">!=</span> <span class="n">other_flag_num_type</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The two instances should have the same type:</span><span class="se">\n</span><span class="s2">&quot;</span>
                                 <span class="sa">f</span><span class="s2">&quot;Source is </span><span class="si">{</span><span class="n">other_flag_num_type</span><span class="si">}</span><span class="s2"> and Destination is </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">flag_numtype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_traces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">whattype</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">get_trace</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">whattype</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The two instances should have the same axis type:</span><span class="se">\n</span><span class="s2">&quot;</span>
                                 <span class="sa">f</span><span class="s2">&quot;Source is </span><span class="si">{</span><span class="n">other</span><span class="o">.</span><span class="n">get_trace</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">whattype</span><span class="si">}</span><span class="s2"> and Destination is </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_traces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">whattype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trace_filter</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span>  <span class="c1"># There is nothing to add stop here</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># No traces are present</span>
            <span class="c1"># if no X axis is present, copy from the first one</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flag_numtype</span> <span class="o">=</span> <span class="n">other_flag_num_type</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flag_log</span> <span class="o">=</span> <span class="s1">&#39;log&#39;</span> <span class="ow">in</span> <span class="n">other_flags</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flag_forward</span> <span class="o">=</span> <span class="s1">&#39;forward&#39;</span> <span class="ow">in</span> <span class="n">other_flags</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_name</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">get_raw_property</span><span class="p">(</span><span class="s1">&#39;Plotname&#39;</span><span class="p">)</span>
            <span class="n">oaxis</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">get_trace</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">new_axis</span> <span class="o">=</span> <span class="n">Trace</span><span class="p">(</span><span class="n">oaxis</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">get_axis</span><span class="p">(</span><span class="n">from_step</span><span class="p">),</span> <span class="n">oaxis</span><span class="o">.</span><span class="n">whattype</span><span class="p">,</span> <span class="n">oaxis</span><span class="o">.</span><span class="n">numerical_type</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_traces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_axis</span><span class="p">)</span>
            <span class="n">force_axis_alignment</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">force_axis_alignment</span> <span class="ow">or</span> <span class="n">minimum_timestep</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_axis</span><span class="p">:</span>
                <span class="n">my_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_axis</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">my_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_traces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_wave</span><span class="p">()</span>
            <span class="n">other_axis</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">get_axis</span><span class="p">(</span><span class="n">from_step</span><span class="p">)</span>
            <span class="n">new_axis</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">minimum_timestep</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># incomming data counter</span>
                <span class="n">e</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># existing data counter</span>

                <span class="k">while</span> <span class="n">e</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">my_axis</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">other_axis</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="n">other_axis</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">my_axis</span><span class="p">[</span><span class="n">e</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">admissible_error</span><span class="p">:</span>
                        <span class="n">new_axis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">my_axis</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">e</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">elif</span> <span class="n">error</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c1"># Other axis is smaller</span>
                        <span class="n">new_axis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other_axis</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">new_axis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">my_axis</span><span class="p">[</span><span class="n">e</span><span class="p">])</span>
                        <span class="n">e</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># Creating the New Axis</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_new_axis</span> <span class="o">=</span> <span class="n">new_axis</span>

                <span class="k">for</span> <span class="n">trace_name</span> <span class="ow">in</span> <span class="n">trace_filter</span><span class="p">:</span>
                    <span class="n">imported_trace</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">get_trace</span><span class="p">(</span><span class="n">trace_name</span><span class="p">)</span>
                    <span class="n">new_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rename_netlabel</span><span class="p">(</span><span class="n">trace_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="n">imported_trace</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">new_name</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_imported_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">imported_trace</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_traces</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">get_axis</span><span class="p">(</span><span class="n">from_step</span><span class="p">)),</span> \
                <span class="s2">&quot;The two instances should have the same size. To avoid this use force_axis_alignment=True option&quot;</span>
            <span class="k">for</span> <span class="n">trace_name</span> <span class="ow">in</span> <span class="n">trace_filter</span><span class="p">:</span>
                <span class="n">trace</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">get_trace</span><span class="p">(</span><span class="n">trace_name</span><span class="p">)</span>
                <span class="n">new_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rename_netlabel</span><span class="p">(</span><span class="n">trace_name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">trace</span><span class="o">.</span><span class="n">get_wave</span><span class="p">(</span><span class="n">from_step</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_traces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Trace</span><span class="p">(</span><span class="n">new_name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">trace</span><span class="o">.</span><span class="n">whattype</span><span class="p">,</span> <span class="n">numerical_type</span><span class="o">=</span><span class="n">trace</span><span class="o">.</span><span class="n">numerical_type</span><span class="p">))</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_interpolate</span><span class="p">(</span><span class="n">trace_data</span><span class="p">,</span> <span class="n">trace_axis</span><span class="p">,</span> <span class="n">new_axis</span><span class="p">:</span> <span class="n">array</span><span class="p">):</span>
        <span class="n">new_data</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_axis</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">trace_data</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">new_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">slope</span> <span class="o">=</span> <span class="p">(</span><span class="n">trace_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">trace_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">trace_axis</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">trace_axis</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_axis</span><span class="p">):</span>
            <span class="k">while</span> <span class="n">trace_axis</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">t</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">slope</span> <span class="o">=</span> <span class="p">(</span><span class="n">trace_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">trace_data</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">trace_axis</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">trace_axis</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">new_data</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">trace_data</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">slope</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">trace_axis</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">new_data</span>

    <span class="k">def</span> <span class="nf">_consolidate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_axis</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imported_data</span><span class="p">:</span>
            <span class="n">new_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_new_axis</span>
            <span class="n">axis_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_axis</span><span class="p">)</span>
            <span class="n">old_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_traces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">axis_length</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">old_axis</span><span class="p">):</span>
                <span class="n">my_axis</span> <span class="o">=</span> <span class="n">old_axis</span><span class="o">.</span><span class="n">data</span>
                <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_traces</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="n">trace</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interpolate</span><span class="p">(</span><span class="n">trace</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">my_axis</span><span class="p">,</span> <span class="n">new_axis</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">imported_trace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_imported_data</span><span class="p">:</span>
                <span class="n">new_trace</span> <span class="o">=</span> <span class="n">Trace</span><span class="p">(</span><span class="n">imported_trace</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">_interpolate</span><span class="p">(</span><span class="n">imported_trace</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">imported_trace</span><span class="o">.</span><span class="n">axis</span><span class="p">,</span> <span class="n">new_axis</span><span class="p">),</span>
                                  <span class="n">imported_trace</span><span class="o">.</span><span class="n">whattype</span><span class="p">,</span> <span class="n">imported_trace</span><span class="o">.</span><span class="n">numerical_type</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_traces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_trace</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_traces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Trace</span><span class="p">(</span><span class="n">old_axis</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">new_axis</span><span class="p">,</span>
                                    <span class="n">old_axis</span><span class="o">.</span><span class="n">whattype</span><span class="p">,</span> <span class="n">old_axis</span><span class="o">.</span><span class="n">numerical_type</span><span class="p">)</span>  <span class="c1"># Replaces with the new axis</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_new_axis</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_imported_data</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

<div class="viewcode-block" id="RawWrite.get_trace"><a class="viewcode-back" href="../../raw_write.html#PyLTSpice.raw_write.RawWrite.get_trace">[docs]</a>    <span class="k">def</span> <span class="nf">get_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace_ref</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the trace with the requested name (trace_ref).</span>

<span class="sd">        :param trace_ref: Name of the trace</span>
<span class="sd">        :type trace_ref: str</span>
<span class="sd">        :return: An object containing the requested trace</span>
<span class="sd">        :rtype: DataSet subclass</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trace_ref</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_traces</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">trace_ref</span> <span class="o">==</span> <span class="n">trace</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                    <span class="c1"># assert isinstance(trace, DataSet)</span>
                    <span class="k">return</span> <span class="n">trace</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2"> doesn&#39;t contain trace </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">trace_ref</span><span class="si">}</span><span class="se">\&quot;\n</span><span class="s2">&quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;Valid traces are </span><span class="si">{</span><span class="p">[</span><span class="n">trc</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">trc</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">_traces</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_traces</span><span class="p">[</span><span class="n">trace_ref</span><span class="p">]</span></div>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper function to access traces by using the [ ] operator.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_trace</span><span class="p">(</span><span class="n">item</span><span class="p">)</span></div>


<div class="viewcode-block" id="tobytes_for_trace"><a class="viewcode-back" href="../../raw_write.html#PyLTSpice.raw_write.tobytes_for_trace">[docs]</a><span class="k">def</span> <span class="nf">tobytes_for_trace</span><span class="p">(</span><span class="n">trace</span><span class="p">:</span> <span class="n">Trace</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">tobytes</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">tobytes</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
    <span class="kn">from</span> <span class="nn">raw_read</span> <span class="kn">import</span> <span class="n">RawRead</span>

    <span class="k">def</span> <span class="nf">test_readme_snippet</span><span class="p">():</span>
        <span class="n">LW</span> <span class="o">=</span> <span class="n">RawWrite</span><span class="p">(</span><span class="n">fastacces</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">tx</span> <span class="o">=</span> <span class="n">Trace</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">3e-3</span><span class="p">,</span> <span class="mf">997E-11</span><span class="p">))</span>
        <span class="n">vy</span> <span class="o">=</span> <span class="n">Trace</span><span class="p">(</span><span class="s1">&#39;N001&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">tx</span><span class="o">.</span><span class="n">data</span> <span class="o">*</span> <span class="mi">10000</span><span class="p">))</span>
        <span class="n">vz</span> <span class="o">=</span> <span class="n">Trace</span><span class="p">(</span><span class="s1">&#39;N002&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">tx</span><span class="o">.</span><span class="n">data</span> <span class="o">*</span> <span class="mi">9970</span><span class="p">))</span>
        <span class="n">LW</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span>
        <span class="n">LW</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">vy</span><span class="p">)</span>
        <span class="n">LW</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">vz</span><span class="p">)</span>
        <span class="n">LW</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;teste_snippet1.raw&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_trc2raw</span><span class="p">():</span>  <span class="c1"># Convert Teledyne-Lecroy trace files to raw files</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Current_Lock_Front_Right_8V.trc&quot;</span><span class="p">)</span>
        <span class="n">raw_type</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>  <span class="c1"># Initialization of parameters that need to be overridden by the file header</span>
        <span class="n">wave_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">tokens</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Segments&#39;</span> <span class="ow">and</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SegmentSize&#39;</span><span class="p">:</span>
                    <span class="n">wave_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">tokens</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Time&#39;</span> <span class="ow">and</span> <span class="n">tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Ampl&#39;</span><span class="p">:</span>
                    <span class="n">raw_type</span> <span class="o">=</span> <span class="s1">&#39;transient&#39;</span>
                    <span class="k">break</span>
        <span class="k">if</span> <span class="n">raw_type</span> <span class="o">==</span> <span class="s1">&#39;transient&#39;</span> <span class="ow">and</span> <span class="n">wave_size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float,float&#39;</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">max_rows</span><span class="o">=</span><span class="n">wave_size</span><span class="p">)</span>
            <span class="n">LW</span> <span class="o">=</span> <span class="n">RawWrite</span><span class="p">()</span>
            <span class="n">LW</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">Trace</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]))</span>
            <span class="n">LW</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">Trace</span><span class="p">(</span><span class="s1">&#39;Ampl&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]))</span>
            <span class="n">LW</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;teste_trc.raw&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">test_axis_sync</span><span class="p">():</span>  <span class="c1"># Test axis sync</span>
        <span class="n">LW</span> <span class="o">=</span> <span class="n">RawWrite</span><span class="p">()</span>
        <span class="n">tx</span> <span class="o">=</span> <span class="n">Trace</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">3e-3</span><span class="p">,</span> <span class="mf">997E-11</span><span class="p">))</span>
        <span class="n">vy</span> <span class="o">=</span> <span class="n">Trace</span><span class="p">(</span><span class="s1">&#39;N001&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">tx</span><span class="o">.</span><span class="n">data</span> <span class="o">*</span> <span class="mi">10000</span><span class="p">))</span>
        <span class="n">vz</span> <span class="o">=</span> <span class="n">Trace</span><span class="p">(</span><span class="s1">&#39;N002&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">tx</span><span class="o">.</span><span class="n">data</span> <span class="o">*</span> <span class="mi">9970</span><span class="p">))</span>
        <span class="n">LW</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">tx</span><span class="p">)</span>
        <span class="n">LW</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">vy</span><span class="p">)</span>
        <span class="n">LW</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">vz</span><span class="p">)</span>
        <span class="n">LW</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;teste_w.raw&quot;</span><span class="p">)</span>
        <span class="n">LR</span> <span class="o">=</span> <span class="n">RawRead</span><span class="p">(</span><span class="s2">&quot;..</span><span class="se">\\</span><span class="s2">test_files</span><span class="se">\\</span><span class="s2">testfile.raw&quot;</span><span class="p">)</span>
        <span class="n">LW</span><span class="o">.</span><span class="n">add_traces_from_raw</span><span class="p">(</span><span class="n">LR</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;V(out)&#39;</span><span class="p">,),</span> <span class="n">force_axis_alignment</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">LW</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;merge.raw&quot;</span><span class="p">)</span>
        <span class="n">test</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        equal = True</span>
<span class="s2">        for ii in range(len(tx)):</span>
<span class="s2">            if t[ii] != tx[ii]:</span>
<span class="s2">                print(t[ii], tx[ii])</span>
<span class="s2">                equal = False</span>
<span class="s2">        print(equal)</span>

<span class="s2">        v = LR.get_trace(&#39;N001&#39;)</span>
<span class="s2">        max_error = 1.5e-12</span>
<span class="s2">        for ii in range(len(vy)):</span>
<span class="s2">            err = abs(v[ii] - vy[ii])</span>
<span class="s2">            if err &gt; max_error:</span>
<span class="s2">                max_error = err</span>
<span class="s2">                print(v[ii], vy[ii], v[ii] - vy[ii])</span>
<span class="s2">        print(max_error)</span>
<span class="s2">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">test_write_ac</span><span class="p">():</span>
        <span class="n">LW</span> <span class="o">=</span> <span class="n">RawWrite</span><span class="p">()</span>
        <span class="n">LR</span> <span class="o">=</span> <span class="n">RawRead</span><span class="p">(</span><span class="s2">&quot;..</span><span class="se">\\</span><span class="s2">tests</span><span class="se">\\</span><span class="s2">PI_Filter.raw&quot;</span><span class="p">)</span>
        <span class="n">LR1</span> <span class="o">=</span> <span class="n">RawRead</span><span class="p">(</span><span class="s2">&quot;..</span><span class="se">\\</span><span class="s2">tests</span><span class="se">\\</span><span class="s2">PI_Filter_resampled.raw&quot;</span><span class="p">)</span>
        <span class="n">LW</span><span class="o">.</span><span class="n">add_traces_from_raw</span><span class="p">(</span><span class="n">LR</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;V(N002)&#39;</span><span class="p">,))</span>
        <span class="n">LW</span><span class="o">.</span><span class="n">add_traces_from_raw</span><span class="p">(</span><span class="n">LR1</span><span class="p">,</span> <span class="s1">&#39;V(N002)&#39;</span><span class="p">,</span> <span class="n">rename_format</span><span class="o">=</span><span class="s1">&#39;N002_resampled&#39;</span><span class="p">,</span> <span class="n">force_axis_alignment</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">LW</span><span class="o">.</span><span class="n">flag_fastaccess</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">LW</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;..</span><span class="se">\\</span><span class="s2">tests</span><span class="se">\\</span><span class="s2">PI_filter_rewritten.raw&quot;</span><span class="p">)</span>
        <span class="n">LW</span><span class="o">.</span><span class="n">flag_fastaccess</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">LW</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;..</span><span class="se">\\</span><span class="s2">tests</span><span class="se">\\</span><span class="s2">PI_filter_rewritten_fast.raw&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_write_tran</span><span class="p">():</span>
        <span class="n">LR</span> <span class="o">=</span> <span class="n">RawRead</span><span class="p">(</span><span class="s2">&quot;..</span><span class="se">\\</span><span class="s2">tests</span><span class="se">\\</span><span class="s2">TRAN - STEP.raw&quot;</span><span class="p">)</span>
        <span class="n">LW</span> <span class="o">=</span> <span class="n">RawWrite</span><span class="p">()</span>
        <span class="n">LW</span><span class="o">.</span><span class="n">add_traces_from_raw</span><span class="p">(</span><span class="n">LR</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;V(out)&#39;</span><span class="p">,</span> <span class="s1">&#39;I(C1)&#39;</span><span class="p">))</span>
        <span class="n">LW</span><span class="o">.</span><span class="n">flag_fastaccess</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">LW</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;..</span><span class="se">\\</span><span class="s2">tests</span><span class="se">\\</span><span class="s2">TRAN - STEP0_normal.raw&quot;</span><span class="p">)</span>
        <span class="n">LW</span><span class="o">.</span><span class="n">flag_fastaccess</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">LW</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;..</span><span class="se">\\</span><span class="s2">tests</span><span class="se">\\</span><span class="s2">TRAN - STEP0_fast.raw&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">test_combine_tran</span><span class="p">():</span>
        <span class="n">LW</span> <span class="o">=</span> <span class="n">RawWrite</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">raw</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;AD820_15&quot;</span><span class="p">,</span> <span class="s2">&quot;../tests/Batch_Test_AD820_15.raw&quot;</span><span class="p">),</span>
            <span class="c1"># (&quot;AD820_10&quot;, &quot;../tests/Batch_Test_AD820_10.raw&quot;),</span>
            <span class="p">(</span><span class="s2">&quot;AD712_15&quot;</span><span class="p">,</span> <span class="s2">&quot;../tests/Batch_Test_AD712_15.raw&quot;</span><span class="p">),</span>
            <span class="c1"># (&quot;AD712_10&quot;, &quot;../tests/Batch_Test_AD712_10.raw&quot;),</span>
            <span class="c1"># (&quot;AD820_5&quot;, &quot;../tests/Batch_Test_AD820_5.raw&quot;),</span>
            <span class="c1"># (&quot;AD712_5&quot;, &quot;../tests/Batch_Test_AD712_5.raw&quot;),</span>
        <span class="p">):</span>
            <span class="n">LR</span> <span class="o">=</span> <span class="n">RawRead</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
            <span class="n">LW</span><span class="o">.</span><span class="n">add_traces_from_raw</span><span class="p">(</span><span class="n">LR</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;V(out)&quot;</span><span class="p">,</span> <span class="s2">&quot;I(R1)&quot;</span><span class="p">),</span> <span class="n">rename_format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_</span><span class="si">{tag}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="n">tag</span><span class="p">,</span> <span class="n">force_axis_alignment</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">LW</span><span class="o">.</span><span class="n">flag_fastaccess</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">LW</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;../tests/Batch_Test_Combine.raw&quot;</span><span class="p">)</span>


    <span class="c1"># test_readme_snippet()</span>
    <span class="c1"># test_axis_sync()</span>
    <span class="c1"># test_write_ac()</span>
    <span class="c1"># test_write_tran()</span>
    <span class="n">test_combine_tran</span><span class="p">()</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">PyLTSpice</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../sim_batch.html">LTSpiceBatch.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../SpiceEditor.html">SpiceEditor.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../raw_read.html">raw_read.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../raw_write.html">LTSpice_RawWrite.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../LTSteps.html">LTSteps.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Histogram.html">Histogram.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../SemiOpLogReader.html">LTSpice_SemiDevOpReader.py</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, Nuno Brum.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 6.0.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>